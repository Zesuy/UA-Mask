chain ua3f_prerouting_after {
    type nat hook prerouting priority 1;
    iifname "br-lan" \
    ip protocol tcp \
    # 豁免局域网、环回、保留地址
    ip daddr != { \
        10.0.0.0/8, \
        172.16.0.0/12, \
        192.168.0.0/16, \
        127.0.0.0/8, \
        169.254.0.0/16 \
    } \
    redirect to :8080
}

chain ua3f_output_after {
    type nat hook output priority -100;
    ip protocol tcp \
    # 豁免局域网、环回、保留地址
    ip daddr != { \
        10.0.0.0/8, \
        172.16.0.0/12, \
        192.168.0.0/16, \
        127.0.0.0/8, \
        169.254.0.0/16 \
    } \
    # 豁免 ua3f-tproxy 自己的流量 (GID 65534)
    meta skgid != 65534 \
    redirect to :8080
}